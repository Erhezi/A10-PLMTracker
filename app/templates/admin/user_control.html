{% extends "base.html" %}

{% block content %}
<h1>Admin User Control</h1>
<p>Welcome, Admin! Here you can manage users.</p>

<table class="user-control-table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for user in users %}
        <tr>
            <td>{{ user.name }}</td>
            <td>{{ user.email }}</td>
            <td>
                <form method="POST" action="{{ url_for('admin.update_user_role', user_id=user.user_id) }}">
                    <select class="user-control-dropdown" name="user_role">
                        <option value="admin" {% if user.user_role == 'admin' %}selected{% endif %}>Admin</option>
                        <option value="user" {% if user.user_role == 'user' %}selected{% endif %}>User</option>
                        <option value="view-only" {% if user.user_role == 'view-only' %}selected{% endif %}>View-Only</option>
                    </select>
                </form>
            </td>
            <td>
                <div class="user-control-buttons">
                    <button class="update-btn" onclick="document.querySelector('form').submit()">Update</button>
                    {% if user.user_id != current_user.id %}
                    <button class="delete-btn" onclick="confirmDeletion('{{ user.user_id }}')">Delete</button>
                    {% endif %}
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
function confirmDeletion(userId) {
    const confirmation = confirm('Are you sure you want to delete this user?');
    if (confirmation) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/admin/delete-user/${userId}`;
        document.body.appendChild(form);
        form.submit();
    }
}
</script>

{% endblock %}
